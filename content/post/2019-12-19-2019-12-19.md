---
title: 2019-12-19周报 - MongoDB大发现
author: dashjay
date: '2019-12-19'
slug: '2019-12-19'
categories: []
tags: []
---

为什么博客里突然冲出来一个周报呢，别问，问就是不知道。

这周干了啥：
#### nodebb MongoDB数据库
看了nodebb对应的MongoDB的后台数据库结构。发现他分为三个库。
- session
- object
- &&&忘了

其中所有静态内容都存在object这个库中。

> 我发现他有个特点，这个特点有点像css，我在这里尝试描述一下，看是否描述的清楚。

曾经我以为MongoDB这样用性能很好，因为可以储存非固定结构的内容，我之前的结构是这样的

```
{
问题信息:blabalba,
回答:[
    {回答信息：blablabal,评论:[{评论信息....}]},
  ]
}
```

我始终以为MongoDB就是这么用的，知道我看了nodebb。他尝试以最小单元来储存，这才让我突然意识到，经常更改的时候回容易发生信息不一致。他是这么存的
```
// 问题
{
qid:1,
问题信息:blablabal
}
// 回答
{
aid:1,
to_qid:1,
答案信息:blabalbal
}
// 评论
{
cid:1,
to_aid:1
to_qid:1
评论内容:blabalbal
}
```
他这样存的时候修改的时候只需要修改单元即可，这种叠层式的储存还体现在下方特点。

```
{
key:"qid:1:like_byuid",
member:[
1,2,3,4
  ]
}
```
他这样储存乍一看有很多问题，比如当点赞人数非常多的话，每次添加一个点赞非常困难。但是相对于每个点赞存一条，我觉得这个方法还是可以的。

那么一条记录，将记录分为若干个[**永远不变的固定部分**，**偶尔改变的部分**，**经常改变的部分**]然后分开存，学到了，搭配Redis可以最好的发挥MongoDB的最大优势。

#### 在微信小程序处理小而复杂的下拉刷新和多tab

微信小程序本身支持下拉刷新，但是有点鸡肋，会出各种问题，因为横向会改变tab，纵向会下拉刷新，还是有点麻烦，描述清楚也有点麻烦，因此我之后再补充。

#### 开发计划

- 教室系统的后台强力开发
- 小程序的信息发布系统整合
